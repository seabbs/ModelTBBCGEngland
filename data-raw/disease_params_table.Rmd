---
title: "Disease Model Parameters"
output:   
    html_notebook: default
    html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(tidyverse)
library(knitr)
library(idmodelr)
```

```{r make table}
disease_params_table <- tibble(
  Parameter = "$C_{eff}$",
  Description = "The assumed effective  number of contacts per infectious TB case.",
  Distribution = "$\\mathcal{U}(0,5)$",
  Units = "-",
  Type = "Literature",
  Source = "[@Vynnycky1999]",
  Method = "Estimated using a dynamic model of TB transmission in England which found an effective contact rate of 1 in 1990. A conservative interval has been chosen around this value to represent the large amount of uncertainty as to its current value.",
  Setting = "England",
  Fitted = "Yes",
  URL = "-"
) %>%
  add_row(
      Parameter = "$C^{hist}_{eff}$",
  Description = "The assumed historic effective number of contacts per infectious TB case. Additive with $C_{eff}$",
  Distribution = "$\\mathcal{U}(10,15)$",
  Units = "-",
  Source = "[@Vynnycky1999]",
  Type = "Literature",
  Method = "Estimated using a dynamic model of TB transmission in England which found an effective contact rate of 1 in 1990 and 20 in 1901. A conservative interval has been chosen to represent the paramter uncertainty. Assumed to decrease linearly over time from 1931 until 1990.",
  Setting = "England",
  Fitted = "Yes",
  URL = "-"
  ) %>% 
    add_row(
    Parameter = "$\\Upsilon$",
    Description = "The age-specific proportion of cases that have pulmonary TB",
    Distribution = "$\\Upsilon_{0-14,15-59,60-89} = \\mathcal{N}(6.29e^{-1}, 1.01e^{-2})$, $\\mathcal{N}(7.06e^{-1}, 4.11e^{-3})$, $\\mathcal{N}(7.50e^{-1}, 5.69e^{-3})$",
    Units = "Proportion",
    Source = "ETS",
    Type = "Derived from data",
    Method = "Estimated using the age-specific proportion of cases that had pulmonary TB in the ETS.",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  ) %>% 
  add_row(
    Parameter = "$\\rho$",
    Description = "The age-specific proportion of pulmonary TB cases that are smear positive",
    Distribution = "$\\rho_{0-14,15-59,60-89} = \\mathcal{N}(3.02e^{-1}, 1.89e^{-2})$, $\\mathcal{N}(6.52e^{-1}, 5.18e^{-3})$, $\\mathcal{N}(5.36e^{-1}, 8.45e^{-3})$",
    Units = "Proportion",
    Source = "ETS",
    Type = "Derived from data",
    Method = "Estimated using the age-specific proportion of pulmonary TB cases that were smear postive in the ETS.",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  ) %>%
add_row(
  Parameter = "$C$",
  Description = "Matrix of contact rates between each age group",
  Distribution = "-",
  Units = "Non-unique yearly contacts.",
  Source = "[@Mossong2008]",
  Type = "Literature",
  Method = "For each parameter sample a contact matrix was bootstrapped from the POLYMOD survey data, standardised using the UK born population in 2005, and then averaged to provided a symmetric contact matrix.",
  Setting = "United Kingdom",
  Fitted = "No",
  URL = "https://doi.org/10.1371/journal.pmed.0050074"
) %>%
add_row(
  Parameter = "$\\iota(t)$",
  Description = "The age-specific number of non-UK born pulmonary TB cases in England each year",
  Distribution = "-",
  Units = "Cases",
  Source = "ETS",
  Type = "Derived from data",
  Method = "The number of pulmonary non-UK born cases for each year were extracted from the ETS and grouped by age.",
  Setting = "England",
  Fitted = "No",
  URL = "-"
) %>%
  add_row(
    Parameter = "$M$",
    Description = "The proportion of mixing between the UK born and non-UK born population.",
    Distribution = "$\\mathcal{U}(0, 0.5)$",
    Units = "Proportion",
    Source = "Assumption",
    Type = "Assumption",
    Method = "Hetergeneous mixing is assumed as the non-UK born population is spatially clustered.",
    Setting = "-",
    Fitted = "No",
    URL = "-"
  ) %>%
  add_row(
    Parameter = "$\\chi$",
    Description = "Age-specific protection from infection with TB due to BCG vaccination",
    Distribution = paste0("$\\chi^v_{i} = \\mathcal{N}(",
                          estimate_norm_dist_from_ci(0.08, 0.29)$mean, "$, $", 
                          scales::scientific(estimate_norm_dist_from_ci(0.08, 0.29)$sd, 3), ")$, where $i$ is the age group vaccinated."),
    Units = "Proportion",
    Source = "[@Roy2014]",
    Type = "Literature",
    Method = "A meta-analysis of the protection from infection due to BCG vaccinatiion in children. It has been assumed that there is no reduction in protection in UK born adults.",
    Setting = "Global",
    Fitted = "Yes",
    URL = "-"
  ) %>%
  add_row(
    Parameter = "$\\epsilon_H$",
    Description = "The age-specific rate of transition to active disease during high risk latent period.",
    Distribution = "$\\epsilon_H^{0-4,5-14,15-89} = \\mathcal{N}(6.95e-3, 1.30e-3)$, $\\mathcal{N}(2.8e-3, 5.61e-4)$, $\\mathcal{N}(3.35e-4, 8.93e-5)$",
    Units = "$days^{-1}$",
    Source = "[@Ragonnet2017]",
    Type = "Literature",
    Method = "From fitting a similar model to contact data in Australia, and Holland. Distribution derived by the assumption of a normal distribution based on 95\\% credible intervals.",
    Setting = "Low incidence",
    Fitted = "Yes",
    URL = "https://doi.org/10.1016/j.epidem.2017.06.002"
  ) %>%
  add_row(
    Parameter = "$\\kappa$",
    Description = "1 over the age-specific average high risk latent period.",
    Distribution = "$\\kappa^{0-4,5-14,15-89} = \\mathcal{N}(1.33e^{-2}, 2.42e^{-3})$, $\\mathcal{N}(1.20e^{-2}, 2.07e^{-3})$, $\\mathcal{N}(7.25e^{-3}, 1.91e^{-3})$",
    Units = "$days^{-1}$",
    Source = "[@Ragonnet2017]",
    Type = "Literature",
    Method = "From fitting a similar model to contact data in Australia, and Holland. Distribution derived by the assumption of a normal distribution based on 95\\% credible intervals." ,
    Setting = "Low incidence",
    Fitted = "Yes",
    URL = "https://doi.org/10.1016/j.epidem.2017.06.002"
  ) %>%
  add_row(
    Parameter = "$\\epsilon_L$",
    Description = "1 over the age-specific average low risk latent period.",
    Distribution = "$\\epsilon_L^{0-4,5-14,15-89} = \\mathcal{N}(8.00e^{-6}, 4.08e^{-6})$, $\\mathcal{N}(9.84e^{-6}, 4.67e^{-6})$, $\\mathcal{N}(5.95e^{-6}, 2.07e^{-6})$",
    Units = "$days^{-1}$",
    Source = "[@Ragonnet2017]",
    Type = "Literature",
    Method = "From fitting a similar model to contact data in Australia, and Holland. Distribution derived by the assumption of a normal distribution based on 95\\% credible intervals.",
    Setting = "Low incidence",
    Fitted = "Yes",
    URL = "https://doi.org/10.1016/j.epidem.2017.06.002"
  ) %>%
  add_row(
    Parameter = "$\\alpha^T$",
    Description = "The BCG vaccine effectiveness at preventing the development of active TB disease in a TB free population",
    Distribution = "$\\alpha^T_{i,i+5,i+10,i+15,i+20,i+25} = 1 - e^{\\alpha^{log(T)}_{i,i+5,i+10,i+15,i+20,i+25}}$, where $\\alpha^{log(T)}_{i,i+5,i+10,i+15,i+20,i+25} = \\mathcal{N}(-1.86, 0.22)$, $\\mathcal{N}(-1.19, 0.24)$, $\\mathcal{N}(-0.84, 0.22)$, $\\mathcal{N}(-0.84, 0.2)$, $\\mathcal{N}(-0.28, 0.19)$, $\\mathcal{N}(-0.23, 0.29))$ and $i$ is the age group vaccinated",
    Units = "Proportion",
    Source = "[@Hart1972; @Mangtani2017] ",
    Type = "Literature",
    Method = "Poisson regression used to calculate Risk Ratios from raw study values. A distribution is then found using the log normal approximation. Effectiveness estimates are caculated using 1 minus the exponentiated log normal distribution.",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  ) %>%
  add_row(
    Parameter = "$\\delta$",
    Description = "Reduction in susceptibilty to infection for low risk latent cases.",
    Distribution = paste0("$\\mathcal{N}(",
                          estimate_norm_dist_from_ci(0.7, 0.86)$mean, "$, $", 
                          scales::scientific(estimate_norm_dist_from_ci(0.7, 0.86)$sd, 3), ")$"),
    Units = "Proportion",
    Source = "@Andrews2012",
    Type = "Literature",
    Method = "A review of prospective cohort studies of persons exposed to individuals with infectious tuberculosis that was published prior to the widespread treatment of latent tuberculosis.",
    Setting = "Global",
    Fitted = "Yes",
    URL = "-"
  ) %>%
  add_row(
    Parameter = "$\\nu$",
    Description = "1 over the average infectious period",
    Distribution = "$\\nu^P_{(0-14,15-89)} = \\mathcal{G}(8.52e-1, 4.57)^{-1}$, $\\mathcal{G}(1.10, 3.36)^{-1}$, $\\nu^E_{(0-14, 15-89)} = \\mathcal{G}(6.97e-1, 2.21)^{-1}$, $\\mathcal{G}(9.06e-1, 1.92)^{-1}$",
    Units = "$years^{-1}$",
    Source = "ETS",
    Type = "Derived from data",
    Method = "Estimated based on the time from initial symptoms to starting treatment",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  ) %>%
    add_row(
    Parameter = "$\\phi$",
    Description = "1 over the time to succesful treatment completion",
    Distribution = "$\\phi_{0-4,5-14,15-89} = \\mathcal{G}(9.86, 16.28)^{-1}$, $\\mathcal{G}(7.73, 11.94)^{-1}$, $\\mathcal{G}(8.46, 13.62)^{-1}$",
    Units = "$years^{-1}$",
    Source = "ETS",
    Type = "Derived from data",
    Method = "Estimated based on the time from starting treatment to treatment completion.",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  ) %>%
    add_row(
    Parameter = "$\\mu^P$",
    Description = "Rate of age-specific pulmonary TB mortality",
    Distribution = "$\\mu^E_{0-14,15-59,60-89} = \\mathcal{N}(4.13e-3, 2.27e-2)$, $\\mathcal{N}(2.25e-2, 1.01e-2)$, $\\mathcal{N}(1.12e-1, 1.51e-2)$ truncated to be greater than 0.",
    Units = "$years^{-1}$",
    Source = "ETS",
    Type = "Derived from data",
    Method = "Estimated based on outcomes at 12 months where cause of death was known, including all-cause deaths in the denominator.",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  ) %>% 
  add_row(
    Parameter = "$\\mu^E$",
    Description = "Rate of age-specific extra-pulmonary TB mortality",
    Distribution = "$\\mu^E_{0-14,15-59,60-89} = \\mathcal{N}(3.63e-3, 3.01e-2)$, $\\mathcal{N}(5.16e-3, 1.56e-2)$, $\\mathcal{N}(4.38e-2, 2.58e-2)$",
    Units = "$years^{-1}$",
    Source = "ETS",
    Type = "Derived from data",
    Method = "Estimated based on outcomes at 12 months where cause of death was known, including all-cause deaths in the denominator.",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  ) %>% 
    add_row(
    Parameter = "$\\zeta^P$",
    Description = "Rate of loss to follow up in pulmonary cases",
    Distribution = "$\\zeta^P_{0-14,15-59,60-89} = \\mathcal{N}(8.07e-3, 2.98e-2)$, $\\mathcal{N}(2.81e-2, 1.51e-2)$, $\\mathcal{N}(7.54e-3, 2.50e-2)$, truncated to be greater than 0.",
    Units = "$years^{-1}$",
    Source = "ETS",
    Type = "Derived from data",
    Method = "Estimated based on outcomes at 12 months for pulmonary TB cases",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  ) %>% 
  add_row(
    Parameter = "$\\zeta^E$",
    Description = "Rate of loss to follow up in extra-pulmonary cases",
    Distribution = "$\\zeta^E_{0-14,15-59,60-89} = \\mathcal{N}(8.07e-3, 2.98e-2)$, $\\mathcal{N}(2.81e-2, 1.51e-2)$, $\\mathcal{N}(7.54e-3, 2.50e-2)$, truncated to be greater than 0.",
    Units = "$years^{-1}$",
    Source = "ETS",
    Type = "Derived from data",
    Method = "Estimated based on outcomes at 12 months for extra-pulmonary TB cases",
    Setting = "England",
    Fitted = "Yes",
    URL = "-"
  )
```

```{r show-table, results = "asis"}
kable(disease_params_table, escape = FALSE, booktabs = TRUE)
```


```{r add-table-to-package}
## Add to package
devtools::use_data(disease_params_table, overwrite = TRUE)

##Add as raw csv
write_csv(disease_params_table, "data-proc/disease_params_table.csv")
```
